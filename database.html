
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    

    <title>Using a Database to cache items locally &mdash; python-glyr 0.9.9beta documentation</title>

<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>


    
    <link rel="stylesheet" href="_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.9beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/searchtools.js"></script>
    <link rel="top" title="python-glyr 0.9.9beta documentation" href="index.html" />
    <link rel="next" title="Miscellaneous Functions" href="misc.html" />
    <link rel="prev" title="Looking up Providers" href="provider.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="misc.html" title="Miscellaneous Functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="provider.html" title="Looking up Providers"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">python-glyr 0.9.9beta documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="using-a-database-to-cache-items-locally">
<h1>Using a Database to cache items locally<a class="headerlink" href="#using-a-database-to-cache-items-locally" title="Permalink to this headline">¶</a></h1>
<p>Sometimes it&#8217;s nice to have a local database that caches already downloaded items,
so they don&#8217;t get downloaded over and over. This can be achieved quite easy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create a database in /tmp/metadata.db</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="s">&#39;/tmp/&#39;</span><span class="p">)</span>

<span class="c"># use it in queries</span>
<span class="n">qry</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
            <span class="n">artist</span><span class="o">=</span><span class="s">&#39;The Cranberries&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;Zombie&#39;</span><span class="p">,</span>
            <span class="n">get_type</span><span class="o">=</span><span class="s">&#39;lyrics&#39;</span><span class="p">)</span>

<span class="o">...</span>
</pre></div>
</div>
<p>But what happenes if a item is not found? Nothing is written to the db,
and the next time it is requeried. Not always what you want.
If you get an empty return from qry.commit() you could do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">insert_dummy</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">used_query</span><span class="p">):</span>
    <span class="n">dummy</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">make_dummy</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">used_query</span><span class="p">,</span> <span class="n">dummy</span><span class="p">)</span>
</pre></div>
</div>
<p>On the next commit you will get this item instead of an empty return,
you can check for it via:</p>
<div class="highlight-python"><pre>if returned_cache.rating is -1:
   # it&#x27;s a dummy
else:
   # real item</pre>
</div>
<p>TODO: __eq__ for Cache</p>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="plyr.Database">
<em class="property">class </em><tt class="descclassname">plyr.</tt><tt class="descname">Database</tt><a class="headerlink" href="#plyr.Database" title="Permalink to this definition">¶</a></dt>
<dd><p>Database gives you access to a local cache of downloaded
(or generated) items. Under the hood a SQLite Database is used.</p>
<dl class="method">
<dt id="plyr.Database.delete">
<tt class="descname">delete</tt><big>(</big><big>)</big><a class="headerlink" href="#plyr.Database.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as lookup, but deletes stuff instead.</p>
<p>See also: <a class="reference external" href="http://sahib.github.com/glyr/doc/html/libglyr-Cache.html#glyr-db-delete">http://sahib.github.com/glyr/doc/html/libglyr-Cache.html#glyr-db-delete</a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Query :</th><td class="field-body">the search query)</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the number of deleted items</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="plyr.Database.edit">
<tt class="descname">edit</tt><big>(</big><big>)</big><a class="headerlink" href="#plyr.Database.edit" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace a cache (or even a list of caches) with a new one.</p>
<p>See also: <a class="reference external" href="http://sahib.github.com/glyr/doc/html/libglyr-Cache.html#glyr-db-edit">http://sahib.github.com/glyr/doc/html/libglyr-Cache.html#glyr-db-edit</a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Query :</th><td class="field-body">The search query.</td>
</tr>
<tr class="field-even field"><th class="field-name">Cache :</th><td class="field-body">The new cache to replace the old one.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The number of replaced caches.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="plyr.Database.foreach">
<tt class="descname">foreach</tt><big>(</big><big>)</big><a class="headerlink" href="#plyr.Database.foreach" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over all items in the database, calling a callback on each item.</p>
<p>The callback needs to take two arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">foreach_callback</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">cache</span><span class="p">):</span>
    <span class="c"># query is the original query used to search this item</span>
    <span class="c"># but only with reconstructable fields filled.</span>
    <span class="c"># cache is the actual item including the data.</span>
    <span class="k">pass</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Py_func :</th><td class="field-body">A callable object, like a function.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="plyr.Database.insert">
<tt class="descname">insert</tt><big>(</big><big>)</big><a class="headerlink" href="#plyr.Database.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a Cache manually into the database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Cache :</th><td class="field-body">The Cache to insert.</td>
</tr>
<tr class="field-even field"><th class="field-name">Query :</th><td class="field-body">The Query describing artist, album, title, get_type</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="plyr.Database.lookup">
<tt class="descname">lookup</tt><big>(</big><big>)</big><a class="headerlink" href="#plyr.Database.lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Lookup data from the cache.</p>
<p>It uses following fields from Query:</p>
<ul class="simple">
<li>artist / album / title / get_type: they must be filled accordingly</li>
<li>donwload: If true search for images, else search for links</li>
<li>number: The number of items to search for.</li>
<li>from: Limit providers.</li>
</ul>
<p>See also: <a class="reference external" href="http://sahib.github.com/glyr/doc/html/libglyr-Cache.html#glyr-db-lookup">http://sahib.github.com/glyr/doc/html/libglyr-Cache.html#glyr-db-lookup</a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Query :</th><td class="field-body">the search query</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a list of caches</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="plyr.Database.make_dummy">
<tt class="descname">make_dummy</tt><big>(</big><big>)</big><a class="headerlink" href="#plyr.Database.make_dummy" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a Dummy Cache with a rating of -1.</p>
<p>This is useful to insert &#8216;empty&#8217; items, indicating
a query that led to no results. (So it does not get re-queried)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An empty Cache</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="plyr.Database.replace">
<tt class="descname">replace</tt><big>(</big><big>)</big><a class="headerlink" href="#plyr.Database.replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace a cache from which you know the md5sum.</p>
<p>See also: <a class="reference external" href="http://sahib.github.com/glyr/doc/html/libglyr-Cache.html#glyr-db-replace">http://sahib.github.com/glyr/doc/html/libglyr-Cache.html#glyr-db-replace</a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Md5sum :</th><td class="field-body">A 32 char long string, being a checksum in hexrepr.</td>
</tr>
<tr class="field-even field"><th class="field-name">Query :</th><td class="field-body">The search query.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Cache :</th><td class="field-body">The Cache to replace the item.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using a Database to cache items locally</a><ul>
<li><a class="reference internal" href="#reference">Reference</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="provider.html"
                        title="previous chapter">Looking up Providers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="misc.html"
                        title="next chapter">Miscellaneous Functions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/database.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="misc.html" title="Miscellaneous Functions"
             >next</a> |</li>
        <li class="right" >
          <a href="provider.html" title="Looking up Providers"
             >previous</a> |</li>
        <li><a href="index.html">python-glyr 0.9.9beta documentation</a> &raquo;</li> 
      </ul>
    </div>
<div class="footer">
    &copy; Copyright 2012, Christoper Pahl.
  Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
  <br />Theme based on <a href="http://readthedocs.org/">Read The Docs</a>

</div>





  </body>
</html>